<div id="frame">
<ul id="sortable-list" class="selectable" ondrop="rewriteInput()">
  <% survey.order_options.shuffle! %>
  <% survey.order_options.each do |option| %>
    <li id="order_option_<%= option.id %>" class="move_handler"><%= option.name %></li>
  <% end %>
</ul>
<div id="hiddenInputs" />
<br />
</div>

<!-- TODO: Put the following two scripts into a content_for -->
<script src="/scripts/Sortable.js"></script>
<script src="/scripts/Sortable.min.js"></script>

<script>
  rewriteInput();

  var sortable_list = document.getElementById('sortable-list');
  var sortable = Sortable.create(sortable_list, { ghostClass: "ghost"}); 

  function rewriteInput() {
    var hiddenInputs = document.getElementById("hiddenInputs");
    while (hiddenInputs.hasChildNodes()) {
      hiddenInputs.removeChild(hiddenInputs.lastChild);
    }

    var listItems = document.getElementsByClassName("move_handler");
    for(var index = 0; index<listItems.length;index++) {
      var input = document.createElement("input");
      input.setAttribute("type", "hidden");
      input.setAttribute("name", "option[]"); 
      input.setAttribute("value", listItems[index].innerHTML + " - " + (index + 1) );         
      document.getElementById("hiddenInputs").appendChild(input); 
    }
    document.getElementById("hiddenInputs").appendChild(document.createElement("br")); 
  }
</script>